<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ASMaQ – Acute Stroke Management Questionnaire</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#1e293b;
    --card-hover:#334155;
    --muted:#94a3b8;
    --text:#f1f5f9;
    --brand:#06b6d4;
    --brand-2:#22d3ee;
    --accent:#8b5cf6;
    --accent-light:#a78bfa;
    --border:#334155;
    --chip:#0ea5e9;
    --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.3), 0 8px 10px -6px rgb(0 0 0 / 0.2);
  }
  
  * {
    box-sizing: border-box;
  }
  
  html,body{
    height:100%;
    margin:0;
    padding:0;
  }
  
  body{
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
    color:var(--text);
    font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
    line-height: 1.6;
  }
  
  header{
    position:sticky;
    top:0;
    z-index:10;
    backdrop-filter: blur(12px) saturate(180%);
    background: rgba(15, 23, 42, 0.85);
    border-bottom:1px solid var(--border);
    box-shadow: var(--shadow);
  }
  
  .wrap{
    max-width:1200px;
    margin:0 auto;
    padding:20px 24px;
  }
  
  .brand{
    display:flex;
    align-items:center;
    gap:16px;
  }
  
  .logo{
    width:48px;
    height:48px;
    border-radius:12px;
    background: linear-gradient(135deg, var(--brand), var(--accent), var(--brand-2));
    box-shadow: 0 0 20px rgba(14, 165, 233, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 700;
    color: white;
  }
  
  h1{
    font-size:1.5rem;
    margin:0;
    font-weight:700;
    background: linear-gradient(135deg, var(--brand-2), var(--accent-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .tag{
    color:var(--muted);
    font-size:.875rem;
    margin-top:4px;
  }
  
  .btn{
    appearance:none;
    border:1px solid var(--border);
    color:var(--text);
    background: var(--card);
    padding:10px 20px;
    border-radius:10px;
    cursor:pointer;
    font-weight:500;
    font-size:.9rem;
    transition: all .2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }
  
  .btn:hover{
    transform: translateY(-2px);
    border-color: var(--brand);
    box-shadow: 0 8px 16px rgba(6, 182, 212, 0.2);
    background: var(--card-hover);
  }
  
  .btn.primary{
    border-color: var(--brand);
    background: linear-gradient(135deg, #0891b2, #06b6d4);
    color: white;
    font-weight: 600;
  }
  
  .btn.primary:hover{
    background: linear-gradient(135deg, #0e7490, #0891b2);
    box-shadow: 0 8px 20px rgba(6, 182, 212, 0.4);
  }
  
  .grid{
    display:grid;
    grid-template-columns: 1fr;
    gap:24px;
    margin:32px 0;
  }
  
  .card{
    background: rgba(30, 41, 59, 0.6);
    backdrop-filter: blur(10px);
    border:1px solid var(--border);
    border-radius:20px;
    box-shadow: var(--shadow);
    padding:28px;
    transition: all .3s ease;
  }
  
  .card:hover{
    border-color: rgba(6, 182, 212, 0.3);
    box-shadow: var(--shadow-lg);
  }
  
  .section-title{
    display:flex;
    align-items:center;
    gap:12px;
    margin:0 0 24px;
    font-weight:700;
    font-size:1.25rem;
    letter-spacing:-.02em;
  }
  
  .chip{
    font-size:.75rem;
    padding:6px 12px;
    border-radius:999px;
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.2), rgba(34, 211, 238, 0.2));
    color: var(--brand-2);
    border:1px solid rgba(14, 165, 233, 0.3);
    font-weight:600;
    text-transform: uppercase;
    letter-spacing: .5px;
  }
  
  .q{
    border-top:1px solid rgba(51, 65, 85, 0.5);
    padding-top:20px;
    margin-top:20px;
  }
  
  .q:first-of-type{
    border-top: none;
    padding-top: 0;
    margin-top: 0;
  }
  
  .q p{
    margin:0 0 16px;
    font-size:1rem;
    font-weight:500;
    color: var(--text);
  }
  
  .likert{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
  }
  
  .pill{
    position:relative;
    flex: 1;
    min-width: 140px;
  }
  
  .pill input{
    position:absolute;
    opacity:0;
    pointer-events:none;
  }
  
  .pill label{
    display:block;
    width: 100%;
    padding:12px 16px;
    border-radius:12px;
    border:2px solid var(--border);
    background: rgba(15, 23, 42, 0.6);
    color: var(--muted);
    cursor:pointer;
    transition: all .2s ease;
    user-select:none;
    text-align: center;
    font-weight:500;
    font-size:.9rem;
  }
  
  .pill label:hover{
    border-color: var(--chip);
    background: rgba(14, 165, 233, 0.1);
    color: var(--text);
    transform: translateY(-2px);
  }
  
  .pill input:checked + label{
    border-color: var(--brand);
    color: white;
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.3), rgba(34, 211, 238, 0.2));
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
    font-weight: 600;
  }
  
  .two-col{
    display:grid;
    grid-template-columns: 1fr;
    gap:24px;
  }
  
  @media(min-width:860px){
    .two-col{
      grid-template-columns: 1fr 1fr;
    }
  }
  
  .footer{
    color:var(--muted);
    font-size:.875rem;
    margin-top:40px;
    text-align:center;
    padding:32px 0 48px;
    border-top: 1px solid var(--border);
  }
  
  .toolbar{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:flex-start;
    margin-top:8px;
  }
  
  .hidden{
    display:none !important;
  }
  
  .field{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin:0;
  }
  
  .field label{
    font-weight:600;
    font-size:.9rem;
    color: var(--text);
  }
  
  .field input, .field select{
    background: rgba(15, 23, 42, 0.8);
    border:2px solid var(--border);
    color:var(--text);
    border-radius:12px;
    padding:12px 16px;
    font-size:1rem;
    outline: none;
    transition: all .2s ease;
  }
  
  .field input:focus, .field select:focus{
    border-color: var(--brand);
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
  }
  
  .hint{
    color:var(--muted);
    font-size:.875rem;
    line-height: 1.5;
  }
  
  .toast{
    position:fixed;
    right:24px;
    bottom:24px;
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(10px);
    border:1px solid #065f46;
    color:#a7f3d0;
    padding:16px 20px;
    border-radius:12px;
    box-shadow: var(--shadow-lg);
    z-index:60;
    font-weight:500;
    animation: slideIn .3s ease;
  }
  
  .toast.error{
    border-color: #dc2626;
    color: #fecaca;
  }
  
  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  .intro-card{
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(139, 92, 246, 0.1));
    border: 1px solid rgba(14, 165, 233, 0.2);
  }
  
  .info-box{
    background: rgba(6, 182, 212, 0.05);
    border-left: 4px solid var(--brand);
    padding: 16px;
    border-radius: 8px;
    margin: 16px 0;
  }
  
  .required{
    color: #ef4444;
    font-weight: 700;
  }
  
  @media(max-width: 768px){
    .brand{
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }
    
    .pill{
      min-width: 100%;
    }
    
    h1{
      font-size: 1.25rem;
    }
  }
</style>
</head>
<body>
<header>
  <div class="wrap" style="display:flex; align-items:center; gap:20px; flex-wrap: wrap;">
    <div class="brand">
      <div class="logo" aria-hidden="true">🧠</div>
      <div>
        <h1>ASMaQ · Manejo del ACV</h1>
        <div class="tag">Cuestionario tipo Likert · Español (Colombia)</div>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="card intro-card">
    <h2 class="section-title">
      📋 Bienvenido/a al cuestionario
      <span class="chip">6–8 minutos</span>
    </h2>
    <div class="two-col">
      <div>
        <p class="hint" style="font-size: 1rem; margin-bottom: 16px;">
          Este cuestionario evalúa conocimientos sobre el manejo agudo del accidente cerebrovascular (ACV). 
          Por favor, responde con sinceridad seleccionando la opción que mejor refleje tu opinión.
        </p>
        <div class="info-box">
          <strong>💡 Instrucciones:</strong><br>
          • Completa todos los campos obligatorios (<span class="required">*</span>)<br>
          • Marca una opción por cada pregunta<br>
          • Si no estás seguro/a, puedes elegir "Neutral"<br>
          • Todas las respuestas son confidenciales
        </div>
      </div>
      <div style="display: flex; flex-direction: column; gap: 16px;">
        <div class="field">
          <label for="participantId">🆔 Identificador <span class="required">*</span></label>
          <input id="participantId" placeholder="Ej.: CC, ID interno, alias..." required />
        </div>
        <div class="field">
          <label for="role">👤 Rol profesional <span class="required">*</span></label>
          <select id="role" required>
            <option value="">— Selecciona tu rol —</option>
            <option>Estudiante de Enfermería</option>
            <option>Estudiante de Medicina</option>
            <option>Enfermería</option>
            <option>Médico/a</option>
            <option>Interno/Residente</option>
            <option>Otro</option>
          </select>
        </div>
        <div class="field">
          <label for="gender">⚧ Género <span class="required">*</span></label>
          <select id="gender" required>
            <option value="">— Selecciona tu género —</option>
            <option>Femenino</option>
            <option>Masculino</option>
            <option>No binario</option>
            <option>Prefiero no decirlo</option>
          </select>
        </div>
        <div class="field" id="semesterField" style="display: none;">
          <label for="semester">📚 Semestre cursado <span class="required">*</span></label>
          <select id="semester">
            <option value="">— Selecciona tu semestre —</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>6</option>
            <option>7</option>
            <option>8</option>
            <option>9</option>
            <option>10</option>
            <option>11</option>
            <option>12</option>
            <option>Egresado</option>
          </select>
        </div>
      </div>
    </div>
  </section>

  <form id="form" class="grid" novalidate></form>

  <section class="card">
    <div style="display: flex; flex-direction: column; gap: 16px; align-items: center;">
      <button type="button" class="btn primary" id="btnSubmit" style="font-size: 1rem; padding: 14px 32px;">
        ✓ Enviar mis respuestas
      </button>
      <span class="hint" id="saveHint">
        ✨ Tus respuestas se guardarán de forma segura e inmediata
      </span>
    </div>
  </section>

  <div class="footer">
    © 2025 · ASMaQ – Acute Stroke Management Questionnaire<br>
    Desarrollado para uso institucional en investigación clínica<br>
    <strong>by Romario Rivera-Sanabria</strong> · Proyecto validación transcultural del cuestionario ASMaQ
  </div>
</main>

<div class="toast hidden" id="toast"></div>

<script>
/* ==========================
   Configuración y datos
========================== */
const DB_BASE = "https://strokeasmaq-default-rtdb.firebaseio.com";
const RESP_PATH = "/responses.json";

const survey = [
  {
    section: "Conocimiento general sobre el ACV",
    items: [
      "La confusión repentina puede ser señal de un derrame cerebral.",
      "Una baja de azúcar (hipoglucemia) puede parecer un derrame cerebral.",
      "Un derrame cerebral puede dar problemas de visión.",
      "Una persona con derrame cerebral puede sentir adormecimiento en un brazo o una pierna.",
      "La pérdida de equilibrio al caminar puede ser señal de derrame cerebral.",
      "Un derrame cerebral puede hacer que la persona esté menos despierta o alerta.",
      "La Escala de Glasgow (GCS) sirve para medir el nivel de conciencia.",
      "Hay que hacer un examen neurológico completo de inmediato en personas que llegan con síntomas de derrame cerebral.",
      "En un derrame cerebral, la presión alta debe bajarse a valores normales de una vez.",
      "Los profesionales de salud deben recibir capacitaciones frecuentes sobre manejo del derrame cerebral."
    ],
    scale: ["Totalmente de acuerdo","De acuerdo","Neutral","En desacuerdo","Totalmente en desacuerdo"]
  },
  {
    section: "Manejo hiperagudo del ACV",
    items: [
      "El derrame cerebral solo es una urgencia médica dentro de las primeras 4,5 horas de iniciado.",
      "Todo paciente con sospecha de derrame cerebral debe hacerse una tomografía de cerebro de inmediato.",
      "Todo paciente con sospecha de derrame cerebral debe ser remitido al neurólogo de inmediato.",
      "Entre más rápido se dé el tratamiento, mejores son los resultados del paciente con derrame cerebral.",
      "La terapia trombolítica se da por vena para disolver coágulos.",
      "Mi hospital cuenta con tratamiento trombolítico.",
      "Hay que revisar la coagulación antes de dar trombolisis.",
      "Todo paciente con derrame cerebral debe tener un electrocardiograma de 12 derivaciones antes de la trombolisis.",
      "Una hemorragia dentro del cerebro es una contraindicación para dar trombolisis."
    ],
    scale: ["Totalmente de acuerdo","De acuerdo","Neutral","En desacuerdo","Totalmente en desacuerdo"]
  },
  {
    section: "Manejo avanzado del ACV",
    items: [
      { q: "¿Usted es capaz de detectar síntomas de un derrame cerebral?", scale: ["Muy probable","Probable","Neutral","Poco probable","Nada probable"] },
      { q: "¿Conoce la prueba FAST (Cara, Brazo, Habla, Tiempo)?", scale: ["Muy familiar","Familiar","Neutral","Poco familiar","Nunca la he oído"] },
      { q: "¿Cómo califica su conocimiento sobre el manejo del derrame cerebral?", scale: ["Muy bueno","Bueno","Neutral","Malo","Muy malo"] },
      { q: "¿Sabe sobre el tratamiento de trombectomía mecánica para el derrame cerebral?", scale: ["Muy al tanto","Al tanto","Neutral","Poco familiar","Nunca lo he oído"] },
      "La trombectomía mecánica se usa para sacar coágulos en un derrame cerebral.",
      "Mi hospital cuenta con servicio de trombectomía mecánica.",
      "Los síntomas del derrame cerebral se pueden revertir con trombolisis o trombectomía mecánica.",
      "Se puede hacer trombectomía mecánica después de una trombolisis.",
      "La trombolisis y la trombectomía mecánica solo se pueden hacer dentro de una ventana de tiempo específica.",
      "Los derrames cerebrales que se descubren al despertar no son candidatos para trombolisis ni trombectomía mecánica."
    ],
    scale: ["Totalmente de acuerdo","De acuerdo","Neutral","En desacuerdo","Totalmente en desacuerdo"]
  }
];

/* ==========================
   Utilidades UI
========================== */
const $ = (id)=>document.getElementById(id);
const show = (el)=>el.classList.remove('hidden');
const hide = (el)=>el.classList.add('hidden');

function toast(msg, ok=true, ms=3500){
  const el = $("toast");
  el.textContent = msg;
  el.className = ok ? "toast" : "toast error";
  show(el);
  setTimeout(()=> hide(el), ms);
}

/* ==========================
   Render del formulario
========================== */
function renderForm(){
  const form = $("form");
  form.innerHTML = "";

  survey.forEach((sec, si)=>{
    const card = document.createElement("section");
    card.className = "card";

    const title = document.createElement("h3");
    title.className = "section-title";
    
    const icons = ["🎯", "⚡", "🔬"];
    title.innerHTML = `${icons[si]} ${sec.section} <span class="chip">Sección ${si+1}/3</span>`;
    card.appendChild(title);

    sec.items.forEach((item, qi)=>{
      const qWrap = document.createElement("div");
      qWrap.className = "q";
      const text = typeof item === "string" ? item : item.q;
      const scale = typeof item === "string" ? sec.scale : item.scale;

      const p = document.createElement("p");
      p.textContent = `${qi+1}. ${text}`;
      qWrap.appendChild(p);

      const likert = document.createElement("div");
      likert.className = "likert";

      scale.forEach((opt, oi)=>{
        const name = `s${si}_q${qi}`;
        const id = `${name}_o${oi}`;
        const pill = document.createElement("div");
        pill.className = "pill";
        const input = document.createElement("input");
        input.type="radio"; input.name=name; input.id=id; input.value=opt; input.required = true;
        const label = document.createElement("label");
        label.setAttribute("for", id); label.textContent = opt;
        pill.appendChild(input); pill.appendChild(label);
        likert.appendChild(pill);
      });

      qWrap.appendChild(likert);
      card.appendChild(qWrap);
    });

    form.appendChild(card);
  });
}

/* ==========================
   Recolección y envío
========================== */
function collectAnswers(){
  const data = {
    timestamp: new Date().toISOString(),
    participantId: $("participantId").value.trim(),
    role: $("role").value,
    gender: $("gender").value,
    semester: $("semester").value || null,
    responses: []
  };

  survey.forEach((sec, si)=>{
    const block = { section: sec.section, items: [] };
    sec.items.forEach((item, qi)=>{
      const name = `s${si}_q${qi}`;
      const sel = document.querySelector(`input[name="${name}"]:checked`);
      const qText = typeof item === "string" ? item : item.q;
      const scale = typeof item === "string" ? sec.scale : item.scale;
      block.items.push({
        question: qText,
        answer: sel ? sel.value : null,
        scale
      });
    });
    data.responses.push(block);
  });

  const totalQs = survey.reduce((n, sec)=> n + sec.items.length, 0);
  const marked = data.responses.reduce((n, sec)=> n + sec.items.filter(i=>!!i.answer).length, 0);
  if(marked < totalQs){
    throw new Error(`⚠️ Te faltan ${totalQs - marked} respuestas por marcar.`);
  }
  return data;
}

async function sendToDB(payload){
  const res = await fetch(DB_BASE + RESP_PATH, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });
  if(!res.ok){
    const t = await res.text().catch(()=> "");
    throw new Error("No se pudo guardar en la base de datos. " + t);
  }
  return res.json();
}

/* ==========================
   Eventos
========================== */
window.addEventListener("DOMContentLoaded", ()=>{
  renderForm();

  // Mostrar/ocultar campo de semestre según rol
  $("role").addEventListener("change", ()=>{
    const role = $("role").value;
    const semesterField = document.getElementById("semesterField");
    const semesterSelect = $("semester");
    
    if (role.includes("Estudiante")) {
      semesterField.style.display = "flex";
      semesterSelect.required = true;
    } else {
      semesterField.style.display = "none";
      semesterSelect.required = false;
      semesterSelect.value = "";
    }
  });

  $("btnSubmit").addEventListener("click", async ()=>{
    try{
      // Validar campos obligatorios primero
      const participantId = $("participantId").value.trim();
      const role = $("role").value;
      const gender = $("gender").value;
      const semester = $("semester").value;
      
      if (!participantId) {
        toast("⚠️ Por favor ingresa tu identificador.", false);
        $("participantId").focus();
        return;
      }
      
      if (!role) {
        toast("⚠️ Por favor selecciona tu rol profesional.", false);
        $("role").focus();
        return;
      }
      
      if (!gender) {
        toast("⚠️ Por favor selecciona tu género.", false);
        $("gender").focus();
        return;
      }
      
      if (role.includes("Estudiante") && !semester) {
        toast("⚠️ Por favor selecciona tu semestre.", false);
        $("semester").focus();
        return;
      }
      
      const payload = collectAnswers();
      await sendToDB(payload);
      toast("✅ ¡Respuestas enviadas con éxito! Gracias por tu participación 🙌", true, 4000);
      
      // Reiniciar formulario
      document.querySelectorAll('input[type="radio"]:checked').forEach(inp=> inp.checked=false);
      $("participantId").value = "";
      $("role").value = "";
      $("gender").value = "";
      $("semester").value = "";
      document.getElementById("semesterField").style.display = "none";
      
      // Scroll al inicio
      window.scrollTo({ top: 0, behavior: "smooth" });
    }catch(err){
      toast(err.message || "❌ Error al enviar las respuestas.", false);
    }
  });
});
</script>
</body>
</html>